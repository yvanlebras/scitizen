<!DOCTYPE html>
<html>
  <head>
    <title>{{ project }}</title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <script type='text/javascript' src='/javascripts/Chart.min.js'></script>
    <script type='text/javascript' src='/javascripts/jquery-2.0.3.min.js'></script>
  </head>
  <body>
    <h1>{{ project }}</h1>
    <p>Welcome to {{ project }}, please help us curate our database...</p>
    <img src="http://osallou.genouest.org:3000/media/{{ file }}" width="300"/>
    <div>
        <p>People said the following</p>
        <div id="canvasplaceholder"/>
    </div>
    <div>
    <p>And you?</p>
    <p>here would appear the same form than mobile app</p>
    </div>
    <script>
    var result = {{{ jsonobject }}};
    var colors = ["#F7464A","#E2EAE9","#D4CCC5","#949FB1","#4D5360"];
    $( document ).ready(function() {
     $("#canvasplaceholder").html("");
      if (!result['stats']) {
          console.log('stat not present');
          result['stats'] = {};
          $.each(result['fields'], function(k,v) {
              result['stats'][k] = {};
              result['stats'][k][v] = 1; 
          });
      }
      $.each(result['stats'], function(k,v) {
          if(k=='location') { return true; }
          $("#canvasplaceholder").append('<div class="graph"><h3>'+k+'</h3><canvas class="cgraph" id="c'+k+'" width="300"></canvas><div id="l'+k+'"><h3>Legend</h3></div></div>');
          ctx = $("#c"+k).get(0).getContext("2d");
          data = [];
          var i=0;
          $.each(result['stats'][k], function(answer,count) {
            data.push({value: count, color: colors[i]});
            $("#l"+k).append('<span class="legenditem" style="background-color: '+ colors[i]+';">'+answer+' ('+count+')</span>');
            i++;
            if(i>=colors.length) { i=0; }
          });
          new Chart(ctx).Doughnut(data);
      });
    });
    </script>
  </body>
</html>
